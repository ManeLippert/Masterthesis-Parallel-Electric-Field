\newpage
\section{Gyrokinetic Field Equations}
\label{sec:fields}

\subsection{Maxwell's Equations}
\label{sub:maxwellEquations}

To obtain a closed system the Vlasov equation gets combined with the Maxwell equations to calculate the pertubated electromagnetic fields. As usual in fusion plasma the Gauss law gets replaced by the quasi neutrality condition which implies that any deviation from neutrality can only happen on small length scales within the Debye lenght and on a timescale much shorter than that of the fluctuations. Due to non-relativistic timescale of the turbulence the dissplacement current in Ampere's law gets also neglected. Taking everything into account the Maxwell's equations can be written as
\begin{gather}
	\begin{aligned}
		\spec{\sum} \spec{Z} e \, \spec{n} &= 0  &\qquad \nabla \times \vect{E}_1 &= - \frac{\partial \vect{B}_1}{\partial t}\\
		\nabla \cdot \vect{B}_1 &= 0 &\qquad \nabla \times \vect{B}_1 &= \mu_0 \spec{\sum} \spec{\vecj}~,
	\end{aligned}
	\label{eq:maxwellEquations}
\end{gather}
where the index $s$ refers to the species of particles, i.e. proton or electron and $\spec{\sum}$ means that all species will be taken into account. For simplicity of the derivation the "s" index gets droped if not explicitly needed. The Maxwell's equation contain densities $n$ and currents $\vecj$ of part icles which can be expressed through the moments of the particle phase space distribution function $f$ as follows
\begin{gather}
	n(\x) = \int \dvelo ~ f(\x, \velo) \\
	j_\parallel = Ze \int \dvelo ~ \vpar f(\x, \velo) \qquad \vecj_\perp = Ze \int \dvelo ~ \vperp f(\x, \velo)~.
	\label{eq:momentsParticleSpace}
\end{gather}
\newpage

\subsection{Pull Back Operation into the Guiding Center Phase Space}
\label{sub:pullback}

Since the Vlasov equations [Eq. (\ref{eq:gyrocenterDeltafSubVlasov})] describes the evolution of the distribution function in the gyrocenter phase space $\fgy$, the particle moments will be expressed with the guiding center phase space distribution function $\fgc$ and which itself will be described through the gyrocenter distrubution function $\fgy$ by performing a pull back from $\fgy$ to the guiding center phase space. A schemamtic about the general idea can be seen in Figure \ref{fig:maxwellEquations}. The pull back will be performed with the pull back operator $\mathcal{P}$ which results in
\begin{gather}
	\fgc = \mathcal{P} \left\{ \fgy \right\} = \fgy \underbrace{- \frac{\fm}{T}\left(Ze \widetilde{\Phi}_1 - \mu \gaBpar\right)}_{\mathrm{Correction~Term}}~,
	\label{eq:pullback}
\end{gather}
where $\widetilde{\Phi}_1$ donates to the oscillating part of the pertubation $\Phi_1$. Here, the correction term contain the fluctuations of the electro-magnetic fields and describes physically the polarization and magnetization effects of the fluctuations on the gyro orbit. \cite{Brizard2007}
 
\inputgraphicsHere{../pictures/theory/Maxwell-Equation-Derivation.tex}{
	Idea of gyrokinetic Maxwell's equations: The particle density $n(\x)$, the current density $\vecj(\x)$ and the gyrocenter distribution function $\fgy$ are expressed in the guiding center phase space.
}{fig:maxwellEquations}

The particle density $n$ and currents $\vecj$ of one species can be expressed with the guiding center distribution function $\fgc$ as
\begin{gather}
	\begin{aligned}
		n(\x) &= \int \dvelo ~ f(\x, \velo) = \frac{B_0}{m} \int \dX\dvpar\dtheta\dmu ~ \delta(\X + \rrho - \x) \fgc \\
		j_\parallel &= Ze \int \dvelo ~ \vpar f(\x, \velo)= \frac{Ze B_0}{m} \int \dX\dvpar\dtheta\dmu ~ \delta(\X + \rrho - \x) \vpar \fgc \\
		\vecj_\perp &= Ze \int \dvelo ~ \vperp f(\x, \velo) = \frac{Ze B_0}{m} \int \dX\dvpar\dtheta\dmu ~ \delta(\X + \rrho - \x) \vperp \fgc ~,
	\end{aligned}
	\label{eq:momentsGuidingCenter}
\end{gather}
where $B_0/m$ is the Jacobian of the guiding center coordinates. The delta function $\delta$ appears due to the change of coordinates and gurantees that the spatial region taken into account in the integral remains unchanged during the coordinate transformation. Physically, the delta function $\delta$ expresses that all particles which have a Larmor orbit crossing a given point $\x$ in the real space contribute to the particle density [Fig. \ref{fig:densityContribution}]. 

\inputgraphicsHere{../pictures/theory/Particle-Density.tex}{
	Connection between density of particles $\spec{n}(\x)$ and density of guiding centers: Gyro orbits with different guiding center $\X$ (gray dashed circles) can cross in postion $\x$, such that the respective gyrating particles add to the particle density $\spec{n}$ there. For a fixed Larmor radius $\spec{\rho} = \abs{\spec{\rrho}} = \abs{\spec{\rho} \vect{a}}$ (\textcolor{Notared}{red}) the particle density $\spec{n}$ at $\x$ is obtained by collecting the contributions of all guiding centers on a circle with radius $\spec{\rho}$ centered at position $\x$ (\textcolor{Notablue}{blue} circle).
}{fig:densityContribution}

\subsection{Gyrooperator $\mathcal{G}$}
\label{sub:gyroOperator}

As stated in Chapter \ref{sub:guidingcenterLagrangian} the gyrooperator $\mathcal{G}$ averages over the gyrophase $\theta$ which is mostly used in the derivation of the Vlasov equation and is defined as
\begin{gather}
    \tga{\{G(\x)\}} = \ga{G}(\X) = \frac{1}{2\pi} \intss{0}{2\pi} \dtheta ~ G(\X + \rrho(\theta))~.
    \label{eq:gyroOperatorRevision}
\end{gather}
To derive the field equations a second kind of gyrooperator will be introduced as
\begin{gather}
    \tgad{\{G(\X)\}} = \gad{G}(\x) = \frac{1}{2\pi} \intss{0}{2\pi} \dX\dtheta ~ \delta(\X + \rrho(\theta) - \x) G(\X)~,
    \label{eq:gyroOperatorDagger}
\end{gather}
where $\mathcal{G}^\dagger$ the hermitian conjugate of $\mathcal{G}$\cite{Told_PHD} and the delta function $\delta$ originates from the pull back operation from Chapter \ref{sub:pullback}.\cite{Merlo_PHD} Furthermore, the double gyroaverage operator is defined as
\begin{gather}
    \tgad{\bigl\{ \tga{\{G(\x)\}} \bigr\}} = \gad{\ga{G}}(\x) = \frac{1}{(2\pi)^2} \intss{0}{2\pi} \dtheta \intss{0}{2\pi} \dtheta' ~ G(\X - \rrho(\theta) + \rrho(\theta'))~,
    \label{eq:gyroOperatorDouble}
\end{gather}
which performs a gyroaverage of the field value at all gyrocenter positions $\X$ with particle position $\x$ in their trajectory. \cite{Maurer_PHD}
\newpage

\subsection{Perturbated Electrostatic Potential $\Phi_1$}
\label{sub:fieldPotential}

To evaluate the pertrubated electrostatic potential $\Phi_1$ the modified guiding center distribution function $\fgc$ [Eq. (\ref{eq:pullback})] gets inserted into the equation for the particle density $n(\x)$ which results in
\begin{gather}
	\begin{aligned}
		n(\x) &= \frac{B_0}{m} \int \dX\dvpar\dtheta\dmu ~ \delta(\X + \rrho - \x) \left(\fgy - \frac{\fm}{T}\left(Ze \widetilde{\Phi}_1 - \mu \gaBpar\right) \right)\\
		     &= \bar{n}(\x) + n_\mathcal{P}(\x)~,
	\end{aligned}
	\label{densityPullback}
\end{gather}
with the density of the gyrocenter $\ga{n}(\x)$ and the variations on the gyro orbit to the particle density $n_\mathcal{P}(\x)$ which describes the polarization effects of the fluctuating fields on the gyro orbit \cite{Brizard2007}. The gyrocenter density can be simplyfied with the gyroperator $\mathcal{G}^\dagger$ [Eq. (\ref{eq:gyroOperatorDagger})] to
\begin{gather}
		\ga{n}(\x) = \frac{B_0}{m} \int \dX\dvpar\dtheta\dmu ~ \delta(\X + \rrho - \x) \fgy = \frac{2\pi B_0}{m} \int \dvpar\dmu ~ \gad{\fgy}~.
	\label{eq:gyrocenterDensity}
\end{gather}
The polarization density $n_\mathcal{P}$ is given by
\begin{gather}
	n_\mathcal{P}(\x) =  - \frac{2\pi B_0}{m} \int \dvpar\dmu ~ \frac{\fm}{T} \left( Ze \left(\Phi_1(\x) - \gad{\gaPhi}(\x) \right) -  \mu \gad{\gaBpar} \right) ~,
	\label{eq:polarizationDensity}
\end{gather}
where $n_0$ is a background density, T is a background temperature. To derive the term for the polarization density $n_\mathcal{P}$ the oscillating Part of the electro static potential got replaced with $\widetilde{\Phi}_1(\X+ \rrho) = \Phi_1(\X + \rrho) - \gaPhi (\X)$ and the gyrooperator $\mathcal{G}^\dagger$ were used. Taking everything into account and insert it into the quaisneutrality equation $\spec{\sum} \spec{Z} e \, \spec{n} = 0$ the field equation for the perturbated electrostatic potential $\Phi_1$ is given by
\begin{gather}
	\begin{aligned}
		&\spec{\sum} \frac{\spec{Z^2} e^2}{\spec{m}} \int \dvpar\dmu ~ \frac{\speccrm{F}{M}}{\spec{T}} \left(\Phi_1(\x) - \gad{\gaPhi}(\x) \right) =  \\
		&\spec{\sum} \frac{\spec{Z} e}{\spec{m}} \int \dvpar\dmu ~ \gad{\spec{\fgy}} + \frac{\speccrm{F}{M}}{\spec{T}} \mu \gad{\gaBpar} ~.
	\end{aligned}
	\label{eq:fieldPotential}
\end{gather}

\newpage

\subsection{Perturbated Parallel Magnetic Field $\Bpar$}
\label{sub:fieldMagnetic}

The perpendicular compentent of Ampere's law can be written as 
\begin{gather}
	(\nabla \times \Bpar)_\perp = \left( \begin{array}{c} \partial_y \Bpar - \partial_z B_{1 y} \\ \partial_z B_{1x} - \partial_x \Bpar \end{array} \right) = \mu_0 \vecj_{1 \perp}~,
	\label{eq:perpendicularAmpereLaw}
\end{gather}
where $z$ is the direction of the equilibrium magnetic field $B_0$. The parallel gradients of the pertrubated magnetic field can be neglegted since they are one order smaller than the perpendicular ones, which results in
\begin{gather}
	\left( \begin{array}{r} \partial_y \Bpar \\ - \partial_x \Bpar \end{array} \right) = \nabla_{\!\perp} \Bpar \times \vecb = \mu_0 \vecj_{1 \perp}~.
\end{gather}
After performing the pull back operation the perpendicular current $\vecj_{1\perp}$ is given by 
\begin{gather}
		\vecj_{1\perp} = \frac{Ze B_0}{m} \int \dX\dvpar\dtheta\dmu ~ \delta(\X + \rrho - \x) \vperp \left(\fgy - \frac{\fm}{T}\left(Ze \widetilde{\Phi}_1 - \mu \gaBpar\right) \right) ~.
	\label{eq:perpendicularCurrentPullback}
\end{gather}
Inserting the pertrubated perpenedicular current $\vecj_{1 \perp}$ into Ampere's law.

\textbf{TODO:}
\begin{itemize}
	\item Derive Equation for pertrubated parallel magnetic Field $\Bpar$ with Gyrooperators
	\item Think about gettting $\Bpar$ without the use of the technic from Ref. \citenum{Derivation}
\end{itemize}

\newpage

\subsection{Plasma Induction $\Apar$}
\label{sub:fieldInduction}

To express the parallel pertrubation of the vector potential $\Apar$, i.e. the plasma induction, the method is analogous to Chapter \ref{sub:fieldPotential}. Using the Coulomb gauge $\nabla \cdot \A_1 = 0$ in the parallel compentent of Ampere's law results in
\begin{gather}
	\nabla^2 \Apar = - \mu_0 j_{1\parallel} = - \mu_0 \spec{\sum} j_{1\parallel,s}~.
	\label{eq:parallelAmpereLaw}
\end{gather}
Performing the pull back one last time the parallel perturbation of the current density $j_{1\parallel}$ is given by
\begin{gather}
	\begin{aligned}
		j_{1\parallel} &= \frac{Ze B_0}{m} \int \dX\dvpar\dtheta\dmu ~ \delta(\X + \rrho - \x) \vpar \left(\fgy - \frac{\fm}{T}\left(Ze \widetilde{\Phi}_1 - \mu \gaBpar\right) \right)\\
					   &= \frac{Ze B_0}{m} \int \dX\dvpar\dtheta\dmu ~ \delta(\X + \rrho - \x) \vpar \fgy \\
					   &= \frac{2\pi Ze B_0}{m} \int \dvpar\dmu ~ \gad{\vpar \fgy}~,
	\end{aligned}
	\label{eq:parallelCurrentPullback}
\end{gather}
although the term $\vpar \fm$ vanishes during the integration along $\vpar$, due to symmetry of the Maxwellian $\fm$. 
Inserting Equation (\ref{eq:parallelCurrentPullback}) into Ampere's law yields the field equation for the plasma induction as follows
\begin{gather}
	\nabla^2 \Apar = - \spec{\sum} \frac{2\pi \spec{Z}e \mu_0 B_0}{\spec{m}}  \int \dvpar\dmu ~ \gad{\vpar \spec{\fgy}}~.
	\label{eq:fieldInduction}
\end{gather}
\newpage

\subsection{Inductive Electric Field $\Epar$}
\label{sub:fieldEpar}

Global Gyrokinetic simulations are suffering from numerical problems, mainly from the cancellation problem \cite{Chen2001} examined codes \cite{Cummings_PHD} which uses the paticle-in-cell or the Eulerian methods. This problem limits the electromagnetic investigations to extremely low $\beta$ parameters. \cite{Naitou1995} As in Chapter \ref{sub:approximation} discussed gets the density distribution function $f$ seperated into an equilibrium part $f_0$, i.e. a Maxwellian $\fm$, and a pertrubated part $\df$. Through the total electric field $\gaE$ in the time derivative from the parallel velocity $\vpar$ [Eq. (\ref{eq:totalElectricField}) \& (\ref{eq:motionEquation})] the time derivative of the pertrubed vector potential $\partial_t \gaApar$ appears in the Source term [Eq. (\ref{eq:sourceTerm})] which is computationally difficult to evaluate. To avoid further complications a modified distribution function $g$ will be introduced as
\begin{gather}
	g = \df + \frac{Ze \vpar}{T} \gaApar \fm ~.
	\label{eq:modifiedDistrubutionFunction}
\end{gather}
% Substituting the modified distribution function $g$ into Equation (\ref{eq:gyrocenterDeltafSubVlasov}) results in
% \begin{gather}
% 	\frac{\partial g}{\partial t} + \vchi \cdot \nabla g + (\vpar \vecb_0 + \vD) \cdot \nabla \df - \frac{\vecb_0}{m} \cdot (Z e \nabla \Phi_0 + \mu \nabla B_0 - m R \Omega^2 \nabla R) \frac{\partial \df}{\partial \vpar} = S
% 	\label{eq:modifiedGyrocenterDeltafSubVlasov}
% \end{gather}
% \begin{gather}
% 	S = - (\vchi + \vD) \cdot \tilde{\nabla} \fm + \frac{\fm}{T} (\vpar \vecb_0 + \vD) \cdot (-Ze \nabla \gaPhi - \mu \nabla \gaBpar) ~.
% 	\label{eq:modifiedSourceTerm}
% \end{gather}
This is method is currently implemented in GKW\cite{Peeters2009A}. The goal of this Chapter is to handle the $\partial_t \gaApar$ term with the consideration of electromagnetic fields and rework the Vlasov equation and fiels equations for GKW. This section follows the work of P.C. Crandall in his Disseration\cite{Crandall_PHD}.
\bigskip

First the Vlasov equation gets written down in the $\df$ framework with the source term [Eq. (\ref{eq:gyrocenterDeltafSubVlasov}) \& (\ref{eq:sourceTerm})] will get simplified into 
\begin{gather}
    \frac{\partial \df}{\partial t} + \frac{Ze \vpar}{T} \partial_t \gaApar \fm = \vlaright~,
    \label{eq:gyrocenterDeltafSubVlasovReduced}
\end{gather}
where $\vlaright$ represents all terms of the Vlasov Equation which excludes the time derivative of plasma induction $\partial_t \gaApar$. The equation of the $\gaApar$ is already astablished in Chapter \ref{sub:fieldInduction} but for this derivation a recall will be made. The equation for $\gaApar$ is given by
\begin{gather}
    \nabla^2 \Apar = - \mu_0 j_{1\parallel} = - \spec{\sum} \frac{2\pi \spec{Z}e \mu_0 B_0}{\spec{m}} \int \dvpar\dmu ~ \gad{\vpar \spec{\fgy}}~.
    \label{eq:Aparallel}
\end{gather}
Now the following formalism will be used
\begin{gather}
	\Epar = - \frac{\partial \Apar}{\partial t}~.
\end{gather}
Taking the time derivative of Equation (\ref{eq:Aparallel}) results into the field equation for the induced electric field $
\Epar$ which can be expressed as
\begin{gather}
	\nabla^2 \Epar - \spec{\sum} \frac{2\pi \spec{Z}e \mu_0 B_0}{\spec{m}} \int \dvpar\dmu ~ \gad{\vpar \frac{\partial \spec{\fgy}}{\partial t}} = 0 ~.
	\label{eq:preFieldElectric}
\end{gather}
In Equation (\ref{eq:preFieldElectric}) the time derivative of the gyrocenter distrubution function has to be further simplified for that the gyrokinetic equation shall be rewritten as 
\begin{gather}
	\frac{\partial \fgy}{\partial t} = \vlaright + \frac{Ze \vpar}{T} \gaEpar \fm~.
	\label{eq:gyrocenterDeltafSubVlasovReducedIndElectric}
\end{gather}
Plugging Equation (\ref{eq:gyrocenterDeltafSubVlasovReducedIndElectric}) into Equation (\ref{eq:preFieldElectric}), one can derive the equation for the inductive electric field 
\begin{gather}
	\begin{aligned}
		&\left(\nabla^2 - \spec{\sum} \frac{2\pi (\spec{Z}e)^2 \mu_0 B_0}{\spec{T}\spec{m}} \int \dvpar\dmu ~ \tgad{\vpar^2 F_{\mathrm{M}s} \tga{}}\right) \Epar = \\
		&\spec{\sum} \frac{2\pi \spec{Z}e \mu_0 B_0}{\spec{m}}  \int \dvpar\dmu ~ \tgad{\left\{\vpar \spec{\vlaright}\right\}} = \mu_0 \frac{\partial j_{1\parallel}}{\partial t}~,
	\end{aligned}
	\label{eq:fieldElectric}
\end{gather}
although the relation of $\gaEpar =  \tga{\left\{\Epar\right\}}$ and the definition of $\mathcal{G}^\dagger$ was used to simplyfied the integral on the right-hand side. To complete the derivation of this section the delta-\!$f$ Vlasov equation will be recalled with the inductive filed $\Epar$ in the source term. The delta-\!$f$ Vlasov equation is given by
\begin{gather}
	\frac{\partial \df}{\partial t} + \dot{\X} \cdot \nabla \df - \frac{\vecb_0}{m} \cdot \left(Ze\nabla \Phi_0 + \mu \nabla B_0 - mR \Omega^2 \nabla R \right) \cdot \frac{\partial \df}{\partial v_\parallel} = S~,
	\label{eq:gyrocenterDeltafSubVlasovRecall}
\end{gather}
with the source term
\begin{gather}
	\begin{aligned}
		S = -& (\vchi + \vD) \cdot \tilde{\nabla} \fm + \frac{Z e \vpar}{T} \gaEpar \fm \\
		    -& \frac{\fm}{T} (\vpar \vecb_0 + \vD + \velo_{\gaBperp}) \cdot (Z e \nabla \gaPhi + \mu \nabla \gaBpar)~.
	\end{aligned}
	\label{eq:sourceTermElectric}
\end{gather}

% To obtain a closed system the Vlasov equation gets combined with the Maxwell equations. The particle density $n$ and current density $j$ can be described with the distribution function $f$ as follows
% \begin{gather}
% 	n = \int \mathrm{d}\vect{v}\,f(\vect{x}, \vect{v}, t) \qquad j = q \int \mathrm{d}\vect{v}\, v f(\vect{x}, \vect{v}, t)~,
% 	\label{eq:densitycurrent}
% \end{gather}
% which are then substituted into the Maxwell equations
% \begin{gather}
% 	\begin{aligned}
% 		\nabla \cdot \vect{B} &= 0 &\qquad \nabla \times \vect{B} &= \mu_0\left( \sum_\mathrm{species} j + \epsilon_0 \frac{\partial \vect{E}}{\partial t} \right) \\
% 		\nabla \cdot \vect{E} &= \frac{1}{\epsilon_0} \sum_\mathrm{species} qn &\qquad \nabla \times \vect{E} &= - \frac{\partial \vect{B}}{\partial t}~.
% 	\end{aligned}
% 	\label{eq:maxwell}
% \end{gather}
% The Vlasov equation (\ref{eq:vlasov}) in combination with the Maxwell equations (\ref{eq:densitycurrent}) and (\ref{eq:maxwell}) is the basis of the gyrokinetic model. \cite{Krommes2012}